<!DOCTYPE html>
<meta charset="utf-8">

<body>

    <div id='js-geojson-example'></div>

    <script src="js/jquery.js"></script>
    <script src="js/d3.js"></script>
    <script src="js/common.js"></script>
    <script src="js/js.cookie.js"></script>

    <link rel="stylesheet" href="css/style.css" />

    <script>
        $(document).ready(function() {
            $('body').keypress(function(e) {
                if (e.keyCode == 13) {
                    window.location.href = "index11_intro.html";
                }
            });
        });

        d3.json("Data/blocks.json", function(json) {
            // create a first guess for the projection
            var center = d3.geo.centroid(json)

            var projection = d3.geo.mercator()
                .scale(scale)
                .center(center)
                .translate(offset);

            // create the path
            var blockpath = d3.geo.path().projection(projection);

            // load the car data

            d3.json("Data/car.json", function(carjson) {

                var cardata = randomize(carjson);

                $.post("server.py", {
                  session: Cookies.get('session'),
                  data: JSON.stringify(cardata),
                  page: "10"
                }, function(data) {
                  console.log("file written");
                });

                var selection = car.selectAll('path')
                    .data(cardata.features)
                    .enter()
                    .append('svg:circle')
                    .attr("transform", function(d) {
                        return "translate(" + projection(d.geometry.coordinates) + ")";
                    })

                repeat();

                function repeat() {

                    var transitionDur = 200;

                    selection.attr('r', 5)
                        .attr('fill-opacity', function(d) {
                            return opacity(d.properties.accuracy);
                        })
                        .transition()
                        .duration(transitionDur)
                        .ease("quad")
                        .attr("transform", function(d) {
                            var angle = Math.random() * Math.PI * 2;

                            x = Math.cos(angle) * d.properties.accuracy;
                            y = Math.sin(angle) * d.properties.accuracy;

                            prj = projection(d.geometry.coordinates);

                            prj[0] = prj[0] + x * 3;
                            prj[1] = prj[1] + y * 3;

                            return "translate(" + prj + ")";
                        })
                        .each("end", repeat);
                }


            });

            // add a rectangle to see the bound of the svg
            blocks.append("rect")
                .attr('width', width)
                .attr('height', height)
                .style('stroke', 'black')
                .style('fill', 'none');


        });
    </script>
    <p style="text-align: center">Place the red circle on the
        <strong>least</strong> uncertain object on the map, then press enter.</p>

</body>
